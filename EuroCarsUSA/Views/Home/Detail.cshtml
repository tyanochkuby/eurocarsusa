@model DetailPageForm

<div id="successMessage" class="alert alert-secondary text-primary border-primary rounded-xxl py-2 px-3 start-50 translate-middle fs-4" style="display: none; position: fixed; top: 0; text-align: center; z-index: 1000; margin-top: 5%">
    Message sent!
</div>

<div class="row">
    <div class="col-md-8">

        @*path*@
        <div class="mb-3">
            <a asp-controller="Home" asp-action="BackToIndexWithFilters" class="btn px-3 py-2 btn-secondary border-0 rounded-pill me-1">
                <- Back
            </a>

            <a asp-controller="Home" asp-action="Index" asp-route-make="@ViewBag.Car.Make" class="btn px-3 py-2 btn-secondary border-0 rounded-pill me-1">
                @ViewBag.Car.Make
            </a>
            <a asp-controller="Home" asp-action="Index" asp-route-make="@ViewBag.Car.Make" asp-route-model="@ViewBag.Car.Model" class="btn px-3 py-2 btn-secondary border-0 rounded-pill">
                @ViewBag.Car.Model
            </a>
        </div>

        @*Images*@
        <div class="gallery" id="gallery" itemscope itemtype="http://schema.org/ImageGallery">
            <div class="row justify-content-between">
                <div class="col-md-1 d-flex align-items-center" >
                    <button class="btn btn-primary btn-arrow rounded-pill" id="leftArrowButton"><i class="fas fa-arrow-left"></i></button>
                </div>
                <div class="col-md-10">
                    <figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
                        <a href=@ViewBag.Car.Images[0] data-width="1200" data-height="900" itemprop="contentUrl" id="imageMain" data-index=0> 

                            <img src=@ViewBag.Car.Images[0] style="object-fit: cover; margin-bottom: 20px; width: 100%" itemprop="thumbnail">
                        </a>
                    </figure>
                </div>
                <div class="col-md-1 d-flex align-items-center">
                    <button class="btn btn-primary btn-arrow rounded-pill" id="rightArrowButton"><i class="fas fa-arrow-right"></i></button>
                </div>
            </div>


            <div class="slider variable-width slick-initialized slick-slider slick-dotted" id="carsSlider" role="toolbar" bis_skin_checked="1">
                <div aria-live="polite" class="slick-list draggable" bis_skin_checked="1">
                    <div class="slick-track slider-container" style="opacity: 1;" role="listbox" bis_skin_checked="1">
                        @for (int i = 0; i < ViewBag.Car.Images.Count; i++)
                        {
                            <div class="slick-slide" data-slick-index="@i" aria-hidden="true">
                                <figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject" class="slick-slide" data-slick-index="2"  aria-hidden="true" tabindex="-1" role="option" bis_skin_checked="1">

                                    <a href=@ViewBag.Car.Images[i] class="carPhotoThumbnail" id=@("car-figure-" + i) data-width="1200" data-height="900" itemprop="contentUrl" data-index=@i>
                                        <div class="me-2">
                                            <img src=@ViewBag.Car.Images[i] style="object-fit: cover;" itemprop="thumbnail">
                                        </div>
                                    </a>
                                </figure>
                            </div>
                        }
                    </div>
                </div>
            </div>
            @*
                <div class="row justify-content-center">
                <div class="d-flex flex-row align-items-center">
                    @for (int i = 0; i < ViewBag.Car.Images.Count; i++)
                    {
                        <figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
                            <a href=@ViewBag.Car.Images[i] class="carPhotoThumbnail" data-width="1200" data-height="900" itemprop="contentUrl" index=@i>
                                <img src=@ViewBag.Car.Images[i] style="height: 200px; object-fit: cover; margin-right: 10px;" itemprop="thumbnail">
                            </a>
                        </figure>
                    }
                </div>
            </div> *@


        </div>


        @*Swipe gallery scructure*@
        <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
            <!-- Background of PhotoSwipe.
                 It's a separate element as animating opacity is faster than rgba(). -->
            <div class="pswp__bg"></div>
            <!-- Slides wrapper with overflow:hidden. -->
            <div class="pswp__scroll-wrap">
                <!-- Container that holds slides.
                    PhotoSwipe keeps only 3 of them in the DOM to save memory.
                    Don't modify these 3 pswp__item elements, data is added later on. -->
                <div class="pswp__container">
                    <div class="pswp__item"></div>
                    <div class="pswp__item"></div>
                    <div class="pswp__item"></div>
                    <div class="pswp__item"></div>

                </div>
                <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
                <div class="pswp__ui pswp__ui--hidden">
                    <div class="pswp__top-bar">
                        <!--  Controls are self-explanatory. Order can be changed. -->
                        <div class="pswp__counter"></div>
                        <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                        <button class="pswp__button pswp__button--share" title="Share"></button>
                        <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                        <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                        <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                        <!-- element will get class pswp__preloader--active when preloader is running -->
                        <div class="pswp__preloader">
                            <div class="pswp__preloader__icn">
                                <div class="pswp__preloader__cut">
                                    <div class="pswp__preloader__donut"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                        <div class="pswp__share-tooltip"></div>
                    </div>
                    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
                    </button>
                    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
                    </button>
                    <div class="pswp__caption">
                        <div class="pswp__caption__center"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class="col-md-4">
        <h1>@(ViewBag.Car.Make + " " + ViewBag.Car.Model)</h1>


        <div class="bg-light align-items-center flex-column d-flex">
            <p class="fs-4 mb-0 mt-2">Contact with seller</p>
            <a class="btn btn-secondary rounded-pill w-75 py-2 mt-1 mb-2" id="toggleButton">
                 <span id="showNumber">Show number</span>
                <span id="phoneNumber" style="display: none;"><i class="fas fa-phone fa-rotate-90"></i>  +1234567890</span>
            </a>

            <form asp-controller="Home" asp-action="SendDetailPageForm" method="post" id="detailPageForm" class="w-100">
                    <input type="hidden" asp-for="@Model.CarId" value="@ViewBag.Car.Id" />

                <div class="form-group px-2 py-1">
                    <input class="form-control border-bottom-only text-primary w-100" asp-for="@Model.Name" placeholder="Name" />
                </div>

                <div class="form-group px-2 py-1">
                    <input class="form-control border-bottom-only text-primary" asp-for="@Model.Email" placeholder="Email" />
                    <span asp-validation-for="@Model.Email" class="text-danger"></span>
                </div>

                <div class="form-group px-2 py-1">
                    <input class="form-control border-bottom-only text-primary" asp-for="@Model.PhoneNumber" placeholder="Phone Number" />
                    <span asp-validation-for="@Model.PhoneNumber" class="text-danger"></span>
                </div>

                <div class="form-group px-2 pt-1 pb-3">
                    <textarea class="form-control border-bottom-only text-primary" asp-for="@Model.Message" placeholder="Message" rows="5"></textarea>
                </div>
                <div class="align-items-center flex-column d-flex pb-3">
                    <button type="submit" class="btn btn-primary rounded-pill w-75 py-2"><i class="fas fa-envelope px-1"></i>  Send message</button>
                </div>
            </form>
        </div>

     
    </div>
</div>









<hr style="border-top: 1px solid #000;"> @*divider*@

<div class="row"> <h2>Details</h2></div>

<div class="row">
    
    <div class="col-md-2 ">
        <p>Year</p>
        <p>Mileage</p>
        <p>Color</p>
        <p>Type</p>
        @(ViewBag.Car.EngineVolume != null ? "Engine volume" : "")
    </div>
   
    <div class="col-md-2 text-lg-start">
        <p class="fw-bolder">@ViewBag.Car.Year</p>
        <p class="fw-bolder">@ViewBag.Car.Mileage</p>
        <p class="fw-bolder">@ViewBag.Car.Color</p>
        <p class="fw-bolder">@ViewBag.Car.Type</p>
        <p class="fw-bolder"> @(ViewBag.Car.EngineVolume != null ? ViewBag.Car.EngineVolume.ToString() : "")</p>
    </div>

    <div class="col-md-1"></div>
    
    <div class="col-md-2">
        <p>Make</p>
        <p>Model</p>
        <p>VIN</p>
        <p>Fuel type</p>
        <p>Transmission</p>
    </div>
    <div class="col-md-2">
         <p class="fw-bolder">@ViewBag.Car.Make</p>
         <p class="fw-bolder">@ViewBag.Car.Model</p>
         <p class="fw-bolder">@ViewBag.Car.VIN</p>
         <p class="fw-bolder">@ViewBag.Car.FuelType</p>
         <p class="fw-bolder">@ViewBag.Car.Transmission</p>
    </div>
</div>



@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.0/photoswipe.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.0/photoswipe-ui-default.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validation-unobtrusive/3.2.12/jquery.validate.unobtrusive.min.js"></script>


    <script>
        'use strict';

        /* global jQuery, PhotoSwipe, PhotoSwipeUI_Default, console */

        (function ($) {

            // Init empty gallery array
            var container = [];

            // Loop over gallery items and push it to the array
            $('#gallery').find('figure:has(a.carPhotoThumbnail)').each(function () {
                var $link = $(this).find('a'),
                    item = {
                        src: $link.attr('href'),
                        w: $link.data('width'),
                        h: $link.data('height'),
                        title: $link.data('caption')
                    };
                container.push(item);
            });



            // Define click event on gallery item
            $("#imageMain").click(function (event) {
                // Prevent location change
                event.preventDefault();

                var allImages = Array.from(document.getElementsByClassName('carPhotoThumbnail'));
                allImages = allImages.filter(function (element) {
                    return !element.parentElement.parentElement.classList.contains('slick-cloned');
                });


                console.log(allImages);
                
                var index = $(this).attr('data-index');
                // Define object and gallery options
                var $pswp = $('.pswp')[0],
                    options = {
                        index: index,
                        bgOpacity: 0.85,
                        showHideOpacity: true
                    };

                // Initialize PhotoSwipe
                var gallery = new PhotoSwipe($pswp, PhotoSwipeUI_Default, container, options);
                gallery.init();
            });

            $(".carPhotoThumbnail").click(function (event) { 
                event.preventDefault();

                var index = $(this).attr('data-index');

                var newImageSrc = $(this).attr('href');

                
                $('.carPhotoThumbnail div').removeClass('carPhotoThumbnailSelected');
                $(this).find('div').addClass('carPhotoThumbnailSelected');

                // Update the main image
                $('#imageMain img').attr('src', newImageSrc);
                $('#imageMain').attr('href', newImageSrc);
                $('#imageMain').attr('data-index', index);


                

            });


        }(jQuery));
    </script>
    <script>
        $(document).ready(function () {
            
            var sliderPosition = 1;

            $("#toggleButton").click(function () {
                $("#phoneNumber").toggle();
                $("#showNumber").toggle();
            });

            $('#leftArrowButton').click(function () {
                $(this).blur();
                var index = parseInt($('#imageMain').attr('data-index'));
                var allImages = Array.from(document.getElementsByClassName('carPhotoThumbnail'));
                allImages = allImages.filter(function (element) {
                    return !element.parentElement.parentElement.classList.contains('slick-cloned');
                });
                var count = allImages.length;
                var newIndex = (index - 1 + count) % count;
                console.log(newIndex);

                var newImageSrc = allImages[newIndex]['href'];
                
                console.log(newImageSrc);
                $('#imageMain img').attr('src', newImageSrc);
                $('#imageMain').attr('href', newImageSrc);
                $('#imageMain').attr('data-index', newIndex);
                $('.carPhotoThumbnail div').removeClass('carPhotoThumbnailSelected');
                //$('.carPhotoThumbnail').eq(newIndex).find('div').addClass('carPhotoThumbnailSelected');
                $(allImages[newIndex]).find('div').addClass('carPhotoThumbnailSelected');

                if((sliderPosition - 1) % 2 == 0)
                {
                    $('.slider-container').slick('slickPrev');
                }
                sliderPosition = sliderPosition - 1;

            });

            $('#rightArrowButton').click(function () {
                $(this).blur();
                var index = parseInt($('#imageMain').attr('data-index'));

                var allImages = Array.from(document.getElementsByClassName('carPhotoThumbnail'));
                allImages = allImages.filter(function (element) {
                    return !element.parentElement.parentElement.classList.contains('slick-cloned');
                });
                var count = allImages.length;
                console.log(count);
                console.log('index');
                console.log(index);
                var newIndex = (index + 1) % count;
                console.log(newIndex);
                var newImageSrc = allImages[newIndex]['href'];

                console.log(newImageSrc);
                $('#imageMain img').attr('src', newImageSrc);
                $('#imageMain').attr('href', newImageSrc);
                $('#imageMain').attr('data-index', newIndex);
                $('.carPhotoThumbnail div').removeClass('carPhotoThumbnailSelected');
                //$('.carPhotoThumbnail').eq(newIndex).find('div').addClass('carPhotoThumbnailSelected');
                $(allImages[newIndex]).find('div').addClass('carPhotoThumbnailSelected');
                if ((sliderPosition + 1) % 2 == 1) {
                    $('.slider-container').slick('slickNext');
                }
                sliderPosition = sliderPosition + 1;
            });

        });
    </script>
    <script>
        $(document).ready(function () {
            $("#detailPageForm").on("submit", function (event) {
                event.preventDefault();

                var form = this;

                $.ajax({
                    url: $(this).attr("action"),
                    type: $(this).attr("method"),
                    data: $(this).serialize(),
                    success: function (response) {
                        if (response.success) {
                            $("#successMessage").slideDown().delay(3000).slideUp(); // Show the success message for 3 seconds
                            form.reset(); // Reset the form
                        } else {
                            alert(response.errors);
                            // Display validation errors
                            console.log(response.errors);
                        }
                    }
                });

            });


        });
    </script>
    <script>
        $(document).ready(function () {
            $('.slider-container').slick({
                slidesToShow: 3,
                slidesToScroll: 2,
                infinite: true,
                arrows: false, // This removes the navigation buttons
                draggable: true,
            });
        });

    </script>


}




