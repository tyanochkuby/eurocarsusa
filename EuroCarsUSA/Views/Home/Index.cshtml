@using EuroCarsUSA.Data.Enum

@model IEnumerable<Car>

@{
    ViewData["Title"] = "Home Page";
}

<div class="text-center">
    <h1 class="display-4">Welcome</h1>
</div>

<div class="py-4 px-4">
    <form method="get" class="d-flex justify-content-center align-items-center  flex-column mb-3" id="filterForm">
        <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#filtersWithButtons" aria-expanded="false" aria-controls="filtersWithButtons">
            Filters
        </button>
        <div class="form-group collapse bg-secondary mt-2" id="filtersWithButtons">
            <div id="filterFields">
                <div id="basicFilters" class="p-3">
                    <div class="row justify-content-center">
                        <div class="col-md-4 py-2">
                            <input type="text" id="make" name="make" class="form-control" placeholder="Make" value="@ViewBag.Make" />
                        </div>
                        <div class="col-md-4 py-2">
                            <input type="number" id="minYear" name="minYear" placeholder="Min year" class="form-control" value="@ViewBag.MinYear" />
                        </div>
                        <div class="col-md-4 py-2">
                            <input type="number" id="maxYear" name="maxYear" placeholder="Max year" class="form-control" value="@ViewBag.MaxYear" />
                        </div>
                    </div>
                    <div class="row justify-content-center">
                        <div class="col-md-4">
                            <input type="text" id="model" name="model" class="form-control" placeholder="Model" value="@ViewBag.Model" />
                        </div>
                        <div class="col-md-4">
                            <input type="number" id="minPrice" name="minPrice" placeholder="Min price" class="form-control" value="@ViewBag.MinPrice" />
                        </div>
                        <div class="col-md-4">
                            <input type="number" id="maxPrice" name="maxPrice" placeholder="Max price" class="form-control" value="@ViewBag.MaxPrice" />
                        </div>
                    </div>
                </div>

                <div class="form-group bg-secondary p-3" id="advancedFilters" style="display: none">

                    <div class="row my-1">
                        <div class="col-md-3">
                            <input type="text" id="make" name="make" class="form-control" placeholder="Make" value="@ViewBag.Make" />
                        </div>
                        <div class="col-md-3">
                            <input type="text" id="model" name="model" class="form-control" placeholder="Model" value="@ViewBag.Model" />
                        </div>
                        <div class="col-md-3">
                            <select id="carType" name="carType" class="form-control w-100">
                                <option value="" disabled selected>Car type</option>
                                @foreach (CarType typeOption in Enum.GetValues(typeof(CarType)))
                                {
                                    @if (ViewBag.CarType == typeOption)
                                    {
                                        <option value="@typeOption" selected>@typeOption.ToString()</option>
                                    }
                                    else
                                    {
                                        <option value="@typeOption">@typeOption.ToString()</option>
                                    }
                                }
                            </select>
                        </div>
                        <div class="col-md-3">
                            <select id="fuelType" name="fuelType" class="form-control w-100">
                                <option value="" disabled selected>Fuel type</option>
                                @foreach (CarFuelType fuelType in Enum.GetValues(typeof(CarFuelType)))
                                {
                                    @if (ViewBag.FuelType == fuelType)
                                    {
                                        <option value="@fuelType" selected>@fuelType</option>
                                    }
                                    else
                                    {
                                        <option value="@fuelType">@fuelType</option>
                                    }
                                }

                            </select>
                        </div>
                    </div>
                    <div class="row my-1">
                        <div class="col-md-3">
                            <select id="transmission" name="transmission" class="form-control w-100">
                                <option value="" disabled selected>Transmission</option>
                                @foreach (CarTransmission transmissionOption in Enum.GetValues(typeof(CarTransmission)))
                                {
                                    @if (ViewBag.Transmission == transmissionOption)
                                    {
                                        <option value="@transmissionOption" selected>@transmissionOption.ToString()</option>
                                    }
                                    else
                                    {
                                        <option value="@transmissionOption">@transmissionOption.ToString()</option>
                                    }
                                }
                            </select>

                        </div>
                        <div class="col-md-3">
                            <input type="text" id="color" name="color" placeholder="Color" class="form-control" value="@ViewBag.Color" />

                        </div>
                        <div class="col-md-3">
                            <input type="number" id="minPrice" name="minPrice" placeholder="Min price" class="form-control" value="@ViewBag.MinPrice" />
                        </div>
                        <div class="col-md-3">
                            <input type="number" id="maxPrice" name="maxPrice" placeholder="Max price" class="form-control" value="@ViewBag.MaxPrice" />
                        </div>
                    </div>
                    <div class="row my-1">
                        <div class="col-md-3">
                            <input type="number" id="minMileage" name="minMileage" placeholder="Min mileage" class="form-control" value="@ViewBag.MinMileage" />
                        </div>
                        <div class="col-md-3">
                            <input type="number" id="maxMileage" name="maxMileage" placeholder="Max mileage" class="form-control" value="@ViewBag.MaxMileage" />
                        </div>
                        <div class="col-md-3">
                            <input type="number" id="minYear" name="minYear" placeholder="Min year" class="form-control" value="@ViewBag.MinYear" />
                        </div>
                        <div class="col-md-3">
                            <input type="number" id="maxYear" name="maxYear" placeholder="Max year" class="form-control" value="@ViewBag.MaxYear" />
                        </div>
                    </div>
                    <div class="row my-1">
                        <div class="col-md-3">
                            <input type="number" id="minEngineVolume" placeholder="Min engine volume" name="minEngineVolume" class="form-control" value="@ViewBag.MinEngineVolume" />
                        </div>
                        <div class="col-md-3">
                            <input type="number" id="maxEngineVolume" placeholder="Max engine volume" name="maxEngineVolume" class="form-control" value="@ViewBag.MaxEngineVolume" />
                        </div>


                        <div class="col-md-3">
                            <select id="fuelType" name="fuelType" class="form-control w-100">
                                <option value="" disabled selected>Fuel type</option>
                                @foreach (CarFuelType fuelType in Enum.GetValues(typeof(CarFuelType)))
                                {
                                    @if (ViewBag.FuelType == fuelType)
                                    {
                                        <option value="@fuelType" selected>@fuelType</option>
                                    }
                                    else
                                    {
                                        <option value="@fuelType">@fuelType</option>
                                    }
                                }

                            </select>
                        </div>
                        </div>
                    </div>
            

            </div>

            <div class="row justify-content-end my-2">
                <button class="btn btn-light w-15 rounded-pill me-2" type="button" id="clearButton">
                    Clear
                </button>
                <button class="btn btn-light w-15 rounded-pill me-2" type="button" data-bs-toggle="collapse" data-bs-target="#advancedFilters" aria-expanded="false" aria-controls="advancedFilters" id="moreFiltersButton">
                    More filters
                </button>
                <button type="submit" class="btn btn-primary w-15 rounded-pill me-4" id="filterSubmitButton">
                    Filter
                </button>
            </div>

        </div>
        
        

        <div class="form-group mt-2">
            <select id="sortOrder" name="sortOrder" class="form-control w-100">
                <option value="" disabled selected>Sort order</option>
                <option value="">New first</option>
                @foreach (SortOrder sortOrderOption in Enum.GetValues(typeof(SortOrder)))
                {
                    @if (ViewBag.SortOrder == sortOrderOption)
                    {
                        <option value="@sortOrderOption" selected>@System.Text.RegularExpressions.Regex.Replace(sortOrderOption.ToString(), "(\\B[A-Z])", " $1")</option>
                    }
                    else
                    {
                        <option value="@sortOrderOption">@System.Text.RegularExpressions.Regex.Replace(sortOrderOption.ToString(), "(\\B[A-Z])", " $1")</option>
                    }
                }
            </select>
        </div>
    </form>
</div>


<div class="album py-5 px-5 bg-light">
    <div class="container" id="carsListing">
        @for (int i = 0; i < Math.Ceiling(Model.Count() / 3.0); i++)
        {

            <div class="row">
                @foreach (Car car in Model.Skip(i * 3).Take(3))
                {
                   
                        <div class="col-md-4">
                             <a asp-controller="Home" , asp-action="Detail" , asp-route-id=@car.Id class="text-black text-decoration-none">
                            <div class="card mb-4 pt-2 box-shadow rounded-xxl">
                                <div class="img-container overflow-hidden mx-3 mt-1">
                                        <img class="card-img float-left rounded-xxl" src=@car.Images[0] alt=@(car.Color + car.Make + car.Model)>
                                    
                                </div>

                                <div class="card-body">

                                    <div class="row justify-content-between">
                                        <!-- Car name -->
                                        <div class="col">
                                             <b>@(car.Make + " " + car.Model)</b> 
                                        </div>
                                        <!-- Price -->
                                        <div class="col text-end">
                                             <p>@(car.Price)</p>
                                        </div>
                                    </div>

                                    <!-- divider -->
                                    <hr style="border-top: 1px solid #000;">


                                    <div class="row justify-content-between">
                                        <div class="col">
                                            <div class="row">
                                                <b>Mileage</b>
                                            </div>
                                            <div class="row">
                                                <p>@car.Mileage</p>
                                            </div>

                                            <div class="row">
                                                <b>Fuel type</b>
                                            </div>
                                            <div class="row">
                                                <p>@car.FuelType.ToString()</p>
                                            </div>

                                        </div>
                                        <div class="col text-end">
                                            <div class="row">
                                                <b>Gearbox</b>
                                            </div>
                                            <div class="row">
                                                <p>@car.Transmission.ToString()</p>
                                            </div>

                                            <div class="row">
                                                <b>Year</b>
                                            </div>
                                            <div class="row">
                                                <p>@car.Year</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                                <div class="row d-flex justify-content-end align-items-end mb-3">
                                    <a class="btn btn-secondary rounded-pill me-2 w-25" asp-controller="Home" , asp-action="Detail" , asp-route-id=@car.Id>
                                        Details
                                    </a>

                                    <button type="button" class="btn btn-primary rounded-pill me-4 w-25">
                                        <i class="fas fa-heart px-3 py-1"></i>
                                    </button>
                                </div>


                            </div>
                        </a>
                        </div>
                    
                }
            </div>
        }
    </div>
</div>

<div class="w-100 text-center mt-3">
    <button class="btn btn-primary rounded-pill" id="showMoreButton">Show more</button>
</div>



@section Scripts {
    <script>
        $(document).ready(function () {
            var additionalCarsDisplayed = 0;

            $('#showMoreButton').click(function () {
                $.ajax({
                    url: '/Home/GetMoreCars',
                    data: { additionalCarsDisplayed: additionalCarsDisplayed },
                    type: 'GET',
                    success: function (data) {
                        var html = $(data);
                        $('#carsListing').append(html);
                        additionalCarsDisplayed += html.data('cars-in-view');
                        console.log(html.data('show-more-button'));
                        if (html.data('show-more-button') == "False") {
                            $('#showMoreButton').hide();
                        }
                    },

                    error: function () {
                        alert('An error occurred while loading more cars.');
                    }
                });
            });
        });
    </script>
    <script>
        $('#showMoreButton').click(function () {
            $(this).blur();
        });
    </script>

    <script>
        $(document).ready(function () {
            var basicFiltersDimensions, advancedFiltersDimensions;

            var filtersExpanded = false;

            $('#filtersWithButtons').css('display', 'block');
            $('#advancedFilters').removeClass('collapse');
            setTimeout(function () {
                basicFiltersDimensions = getActualDimensions('#basicFilters');
                advancedFiltersDimensions = getActualDimensions('#advancedFilters');
                // Hide #filterFields and #advancedFilters again
                $('#filtersWithButtons').css('display', '');
                $('#advancedFilters').addClass('collapse');
            }, 0);

            $('#moreFiltersButton').click(function () {
                if (!filtersExpanded) {
                    $('#filterFields').animate({ height: advancedFiltersDimensions.height, width: advancedFiltersDimensions.width }, 500);
                    $('#basicFilters').fadeOut(200);
                    $('#advancedFilters').fadeIn(200);
                    filtersExpanded = true;
                    $(this).text('Less filters');
                } else {
                    $('#advancedFilters').fadeOut(200);
                    $('#filterFields').animate({ height: basicFiltersDimensions.height, width: basicFiltersDimensions.width }, 500);
                    $('#basicFilters').fadeIn(200);
                    filtersExpanded = false;
                    $(this).text('More filters');
                }
                $(this).blur();
            });

            $('#clearButton').click(function () {
                $('#filterForm input[type="text"], #filterForm input[type="number"]').val('');

                $('#filterForm select').prop('selectedIndex', 0);
                $(this).blur();
            });
            $('#filterSubmitButton').click(function () {
                $(this).blur();
            });




        });

        function getActualDimensions(selector) {
            var previousCss = $(selector).attr("style");

            var dimensions = {
                height: $(selector).outerHeight(true),
                width: $(selector).outerWidth(true)
            };

            $(selector).attr("style", previousCss ? previousCss : "");

            return dimensions;
        }

    </script>
}