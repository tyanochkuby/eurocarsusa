@using EuroCarsUSA.Data.Enum
@using EuroCarsUSA.ViewModels
@using EuroCarsUSA.Views.Shared.Components
@using Microsoft.AspNetCore.Components
@model dynamic

@{
    int i = Model.I;
    var car = Model.Car;
    var uniqueId = Model.UniqueId;
}

<div class="mb-4" id="car-row-@uniqueId">
    <div class="mb-4" id="car-row-@uniqueId">
        <div class="row py-1 m-0 bg-white" 
             onmouseover="showBorder('@uniqueId')"
             onmouseout="hideBorder('@uniqueId')">
            <div class="col">
                <div class="row h-100">
                    <div class="d-none"><component type="typeof(EditableField<Guid>)" render-mode="ServerPrerendered" param-Value="car.Id" param-Name="@($"[{i}].Id")" param-IsVisible="false" /></div>

                    <div class="col">
                        <div class="text-body-lg d-none forEditMode h-100 align-items-center">@car.Make</div>
                        <div class="d-flex forEditMode h-100">
                            <component type="typeof(EnumDropdown<CarMake>)"
                                       render-mode="ServerPrerendered"
                                       param-SelectedValue="car.Make"
                                       param-SelectedValueChanged="@EventCallback.Factory.Create<CarMake>(this, value => car.Make = value)"
                                       param-Name="@($"[{i}].Make")"
                                       param-CssClass="@( "h-100" )" />
                        </div>
                        
                    </div>

                    <div class="col">
                        <div class="text-body-lg d-none forEditMode h-100 align-items-center">@car.Model</div>
                        <div class="d-flex forEditMode h-100">
                            <component type="typeof(EditableField<string>)"
                                       render-mode="ServerPrerendered"
                                       param-Value="car.Model"
                                       param-ValueChanged="@EventCallback.Factory.Create<string>(this, value => car.Model = value)"
                                       param-Name="@($"[{i}].Model")"
                                       param-CssClass="@( "h-100" )" />
                        </div>
                        
                    </div>

                    <div class="col">
                        <div class="text-body-lg d-none forEditMode h-100 align-items-center">@car.Color</div>
                        <div class="d-flex forEditMode h-100">
                            <component type="typeof(EnumDropdown<CarColor>)"
                                       render-mode="ServerPrerendered"
                                       param-SelectedValue="car.Color"
                                       param-SelectedValueChanged="@EventCallback.Factory.Create<CarColor>(this, value => car.Color = value)"
                                       param-Name="@($"[{i}].Color")"
                                       param-CssClass="@( "h-100" )" />
                        </div>
                    </div>

                    <div class="col">
                        <div class="text-body-lg d-none forEditMode h-100 align-items-center">@car.Price</div>
                        <div class="d-flex forEditMode h-100">
                            <component type="typeof(EditableField<int>)"
                                       render-mode="ServerPrerendered"
                                       param-Value="car.Price"
                                       param-ValueChanged="@EventCallback.Factory.Create<int>(this, value => car.Price = value)"
                                       param-Name="@($"[{i}].Price")"
                                       param-CssClass="@( "h-100" )" />
                        </div>
                        
                    </div>
                </div>
            </div>
            <div class="col-auto align-content-center">
                <span onclick="editMode()">Edit Mode</span>
            </div>
            <div class="col-auto p-0 center-items" style="height:48px; width:48px" onclick="toggleVisibility('@uniqueId')">
                <div class="col p-2" id="icon-@uniqueId">
                    @Html.Partial("_Icon", new { IconName = "keyboard_arrow_down", Color = "primary" })
                </div>
            </div>
        </div>
    <div class="border-bottom border-3 border-primary" id="border-@uniqueId" style="opacity: 0; transition: opacity 0.3s;"></div>


    <div class="bg-white overflow-hide overflow-scroll py-2" id="popup-@uniqueId" style="display:none; height:320px;">
            <div class="py-2 ps-3 pe-4 forEditMode d-flex" style="height:56px;">
            <partial name="~/Views/Shared/Components/ImageEditor.cshtml" model="Tuple.Create(car.Images, uniqueId)" />
            <input type="hidden" id="ImagesJson-@uniqueId" name="@($"[{i}].ImagesJson")" value="@car.ImagesJson" />
        </div>

        <div class="py-2 ps-3 pe-4" style="height:56px;">
            <div class="text-body-lg d-none forEditMode h-100 align-items-center">@car.Year</div>
            <div class="d-flex forEditMode h-100">
                    <component type="typeof(EditableField<int>)"
                               render-mode="ServerPrerendered"
                               param-Value="car.Year"
                               param-ValueChanged="@EventCallback.Factory.Create<int>(this, value => car.Year = value)"
                               param-Name="@($"[{i}].Year")"
                               param-CssClass="@( "h-100" )" />
            </div>
            
        </div>

        <div class="py-2 ps-3 pe-4" style="height:56px;">
            <div class="text-body-lg d-none forEditMode h-100 align-items-center">@car.Mileage</div>
            <div class="d-flex forEditMode h-100">
                    <component type="typeof(EditableField<int>)"
                        render-mode="ServerPrerendered"
                        param-Value="car.Mileage"
                        param-ValueChanged="@EventCallback.Factory.Create<int>(this, value => car.Mileage = value)"
                        param-Name="@($"[{i}].Mileage")"
                        param-CssClass="@( "h-100" )" />
            </div>
            
        </div>

        <div class="py-2 ps-3 pe-4" style="height:56px;">
            <div class="text-body-lg d-none forEditMode h-100 align-items-center">@car.Type</div>
            <div class="d-flex forEditMode h-100">
                    <component type="typeof(EnumDropdown<CarType>)"
                        render-mode="ServerPrerendered"
                        param-SelectedValue="car.Type"
                        param-SelectedValueChanged="@EventCallback.Factory.Create<CarType>(this, value => car.Type = value)"
                        param-Name="@($"[{i}].Type")"
                        param-CssClass="@( "h-100" )" />
            </div>
            
        </div>
        
        <div class="py-2 ps-3 pe-4" style="height:56px;">
            <div class="text-body-lg d-none forEditMode h-100 align-items-center">@car.EngineVolume</div>
            <div class="d-flex forEditMode h-100">
                <component type="typeof(EditableField<int>)" 
                    render-mode="ServerPrerendered" 
                    param-Value="car.EngineVolume" 
                    param-ValueChanged="@EventCallback.Factory.Create<int>(this, value => car.EngineVolume = value)" 
                    param-Name="@($"[{i}].EngineVolume")"
                    param-CssClass="@( "h-100" )" />
            </div>
            
        </div>

        <div class="py-2 ps-3 pe-4" style="height:56px;">
            <div class="text-body-lg d-none forEditMode h-100 align-items-center">@car.Transmission</div>
            <div class="d-flex forEditMode h-100">
                <component type="typeof(EnumDropdown<CarTransmission>)" 
                    render-mode="ServerPrerendered" 
                    param-SelectedValue="car.Transmission" 
                    param-SelectedValueChanged="@EventCallback.Factory.Create<CarTransmission>(this, value => car.Transmission = value)" 
                    param-Name="@($"[{i}].Transmission")"
                    param-CssClass="@( "h-100" )" />
            </div>
            
        </div>

        <!-- Drive type??? -->

        <div class="py-2 ps-3 pe-4" style="height:56px;">
            <div class="text-body-lg d-none forEditMode h-100 align-items-center">@car.FuelType</div>
            <div class="d-flex forEditMode h-100">
            <component type="typeof(EnumDropdown<CarFuelType>)" 
                render-mode="ServerPrerendered" 
                param-SelectedValue="car.FuelType" 
                param-SelectedValueChanged="@EventCallback.Factory.Create<CarFuelType>(this, value => car.FuelType = value)" 
                param-Name="@($"[{i}].FuelType")" />
            </div>
        </div>

        <div class="py-2 ps-3 pe-4" style="height:56px;">
            <div class="text-body-lg d-none forEditMode h-100 align-items-center">@car.VIN</div>
            <div class="d-flex forEditMode h-100">
            <component type="typeof(EditableField<string>)" 
                render-mode="ServerPrerendered" 
                param-Value="car.VIN" 
                param-ValueChanged="@EventCallback.Factory.Create<string>(this, value => car.VIN = value)" 
                param-Name="@($"[{i}].VIN")" />
            </div>
        </div>


            <div class="py-2 ps-3 pe-4 forEditMode d-flex" style="height:56px" ;">
            <button type="button" class="btn btn-danger" onclick="deleteCar('@car.Id', '@uniqueId')">Delete</button>
        </div>
    </div>
</div>

<script>
        function editMode() {
            const elements = document.querySelectorAll('.forEditMode');

            elements.forEach(element => {
                if (element.classList.contains('d-none')) {
                    element.classList.remove('d-none');
                    element.classList.add('d-flex');
                } else {
                    element.classList.remove('d-flex');
                    element.classList.add('d-none');
                }
            });
        }
        
        function toggleVisibility(uniqueId) {
            var popupDiv = document.getElementById("popup-" + uniqueId);
            var borderDiv = document.getElementById("border-" + uniqueId);
            var iconDiv = document.getElementById("icon-" + uniqueId); // Иконка

            if (popupDiv.style.display === "none") {
                popupDiv.style.display = "block";
                borderDiv.style.opacity = 1;
                iconDiv.style.transform = "scaleY(-1)"; // Отражение по горизонтали
            } else {
                popupDiv.style.display = "none";
                borderDiv.style.opacity = 0;
                iconDiv.style.transform = "scaleY(1)"; // Сброс отражения
            }
        }

        function showBorder(uniqueId) {
            var popupDiv = document.getElementById("popup-" + uniqueId);
            var borderDiv = document.getElementById("border-" + uniqueId);
            if (popupDiv.style.display === "none") {
                borderDiv.style.opacity = 1;
            }
        }

        function hideBorder(uniqueId) {
            var popupDiv = document.getElementById("popup-" + uniqueId);
            var borderDiv = document.getElementById("border-" + uniqueId);
            if (popupDiv.style.display === "none") {
                borderDiv.style.opacity = 0;
            }
        }

</script>